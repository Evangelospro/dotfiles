#! /bin/bash

#define icons for workspaces 1-9
firstMonitor="eDP-1"
secondMonitor="HDMI-A-1"
currMonitor=$firstMonitor
targetMonitor=$1
currClass=""
currIconPath=""
currTitle=""
debug=$2

appnames() {
if [[ ${1:0:14} == "activewindow>>" ]]; then #set focused workspace
    if [[ $currMonitor == $targetMonitor ]]; then
        string=${1:14}
        currClass="${string/,*/}"
        currTitle=${string/,/ \| }
        [[ $currTitle == " | " ]] && currTitle=""
        currIconPath=$(geticons --no-fallbacks "$currClass" -s 24 -c 1| head -n 1)
        # if it isn't null try with lowercase
        if [[ $currIconPath == "" ]]; then
            currClass=$(echo "$currClass" | tr '[:upper:]' '[:lower:]')
            currIconPath=$(geticons --no-fallbacks "$currClass" -s 24 -c 1 | head -n 1)
        fi
    fi
elif [[ ${1:0:12} == "focusedmon>>" ]]; then #set focused monitor
    string=${1:12}
    currMonitor="${string/,*/}"
fi
if [[ $debug == "debug" ]]; then
    echo "focusedmon>>$currMonitor"
    echo "activewindow>>$currClass"
    echo "icon>>$currIconPath"
else
    # echo "$string\n$class\n$title\n$iconpath"
    echo 	"(box \
                :orientation \"h\" \
                :halign \"start\" \
                :space-evenly false \
                (image \
                    :class \"app-icon\" \
                    :path \"$currIconPath\" \
                    :image-width \"36\") \
                (label \
                    :class \"app-name\" \
                    :limit-width \"35\" \
                    :text \"$currTitle\" ) \
        )"
fi
}

socat -u UNIX-CONNECT:/tmp/hypr/"$HYPRLAND_INSTANCE_SIGNATURE"/.socket2.sock - | while read -r event; do 
appnames "$event"
done
