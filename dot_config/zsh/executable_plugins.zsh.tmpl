[ ! -d $ZINIT[HOME_DIR] ] && mkdir -p "$(dirname $ZINIT[HOME_DIR])"
[ ! -d $ZINIT[HOME_DIR]/.git ] && git clone https://github.com/zdharma-continuum/zinit.git "$ZINIT[HOME_DIR]"

# Loading ZINIT
source "$ZINIT[HOME_DIR]/zinit.zsh"

# Plugins for eval cache
export ZSH_SMARTCACHE_DISABLE=false
export ZSH_SMARTCACHE_DIR="$XDG_CACHE_HOME/zsh/smartcache"
# QuarticCat/zsh-smartcache > mroth/evalcache
zinit load QuarticCat/zsh-smartcache

## evaluting some useful commands and aliases
# smartcache comp register-python-argcomplete pipx
smartcache eval thefuck --alias
smartcache eval direnv hook zsh
smartcache eval atuin init zsh --disable-up-arrow --disable-ctrl-r 2>&1 >/dev/null

# Plugins for annex speedups
zinit light-mode for \
    zdharma-continuum/zinit-annex-patch-dl \
    zdharma-continuum/zinit-annex-bin-gem-node \
    NICHOLAS85/z-a-eval

# Modern Unix commands (ON TOP so they are used later on)
# See https://github.com/ibraheemdev/modern-unix
zinit wait as"null" lucid from"gh-r" for \
    atload"alias ls='lsd -hAFlt --group-dirs first --color=always'; alias la='lsd -laFh'; alias tree='lsd -haFlt --group-dirs first --tree'" sbin"**/lsd" lsd-rs/lsd \
    cp"**/bat.1 -> $ZPFX/share/man/man1" mv"**/autocomplete/bat.zsh -> _bat" completions sbin"**/bat" @sharkdp/bat \
    cp"**/fd.1 -> $ZPFX/share/man/man1" completions sbin"**/fd" @sharkdp/fd \
    cp"**/procs.1 -> $ZPFX/share/man/man1" completions sbin"**/procs" dalance/procs \
    cp"**/hyperfine.1 -> $ZPFX/share/man/man1" completions sbin"**/hyperfine" @sharkdp/hyperfine \
    atload"alias top=btm" completions sbin"**/btm" ClementTsang/bottom \
    atload"alias help=tldr" mv"tealdeer* -> tldr" dl"https://github.com/dbrgn/tealdeer/releases/latest/download/completions_zsh -> _tldr;" completions sbin"tldr" dbrgn/tealdeer \
    atload"alias du=dust" sbin"**/dust" bootandy/dust \
    atload"alias diff=delta" completions sbin"**/delta" dandavison/delta


# HIGHLIGHT useful after grep
zinit ice pick"h.sh"
zinit light Ga0aG/hhighlighter

zinit ice wait lucid nocd
zinit snippet $ZDOTDIR/plugins/dirhistory.zsh

zinit ice wait lucid nocd
zinit light z-shell/zsh-zoxide

zinit ice wait lucid depth=1 pick="async.zsh"
zinit light mafredri/zsh-async

zinit ice wait lucid nocd
zinit light jgogstad/zsh-mask

# natively supported in warp
if [[ $TERM_PROGRAM != "WarpTerminal" ]]; then
    # zinit ice wait lucid depth=1 pick="autopair.zsh" atload="autopair-init"
    # zinit light hlissner/zsh-autopair

    zinit ice wait lucid nocd
    zinit light icatalina/zsh-navi-plugin

    export YSU_IGNORED_ALIASES=(".." "l" "s" "ls" "ll" "cd.." "pdw" "sudo" "fd" "locate")
    export YSU_HARDCORE=0
    zinit ice wait lucid nocd
    zinit light MichaelAquilina/zsh-you-should-use

    {{ if (not .isHeadless) -}}
    zinit ice wait lucid nocd
    zinit light MichaelAquilina/zsh-auto-notify
    {{ end -}}
fi

if [[ $(tput colors) == 256 ]]; then
    zinit ice depth=1 lucid nocd atload'!source $ZDOTDIR/p10k.zsh'
    zinit light romkatv/powerlevel10k
fi

zinit wait'0b' lucid as"completion" blockf atpull'zinit creinstall -q .' \
    atload"source $ZDOTDIR/plugins/zsh-completions_atload.zsh"  \
    light-mode for @zsh-users/zsh-completions

if [[ $TERM_PROGRAM != "WarpTerminal" ]]; then
    zinit ice depth=1 lucid nocd
    zinit light marlonrichert/zsh-autocomplete

    #zinit wait'0b' lucid \
    #atload"source $ZDOTDIR/plugins/zsh-autosuggestions_atload.zsh && _zsh_autosuggest_start" \
    #light-mode for @zsh-users/zsh-autosuggestions
fi

# Syntax highlight must be the last one
zinit ice depth=1 lucid nocd
source $ZDOTDIR/plugins/zsh-syntax-highlighting/dracula.sh
zinit light @zsh-users/zsh-syntax-highlighting

{{ if .isPersonal -}}
# bitwarden auto export session
zinit ice wait lucid nocd
zinit light Game4Move78/zsh-bitwarden

zinit ice wait lucid nocd
zinit light loiccoyle/zsh-github-copilot
{{ end -}}
