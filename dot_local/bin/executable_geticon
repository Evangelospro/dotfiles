#!/usr/bin/env python3
import subprocess
import sys
import json
import os

DEFAULT_ICON = "/usr/share/icons/Papirus/24x24/apps/appgrid.svg"
ICON_SIZE = 22

WINDOW_NAMES = json.loads(open(os.path.expanduser("~/.config/window_names.json")).read())


def getIcon(class_name, size):
    if WINDOW_NAMES.get(class_name):
        icon = WINDOW_NAMES[class_name]["icon"]
        if os.path.exists(os.path.expanduser(icon)):
            return os.path.expanduser(icon)
        else:
            class_name = icon
    for class_name_test in [class_name, class_name.lower()]:
        icon_list = (
            subprocess.check_output(
                ["/usr/bin/geticons", "--no-fallbacks", class_name_test, "-s", str(size), "-c", "1"]
            )
            .decode()
            .strip()
        )
        if icon_list:
            return icon_list
    print(f"Failed to get icon for {class_name} please fix...")
    subprocess.Popen(
        [
            "notify-send",
            "-u",
            "critical",
            "-t",
            "5000",
            f"Icon not found for {class_name} manually fix in windowNames.json",
        ]
    )
    return DEFAULT_ICON


if __name__ == "__main__":
    print(getIcon(sys.argv[1], ICON_SIZE))
